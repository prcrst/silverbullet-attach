var mod=(()=>{var g=Object.defineProperty;var E=Object.getOwnPropertyDescriptor;var N=Object.getOwnPropertyNames;var K=Object.prototype.hasOwnProperty;var u=(e,t)=>{for(var o in t)g(e,o,{get:t[o],enumerable:!0})},$=(e,t,o,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of N(t))!K.call(e,i)&&i!==o&&g(e,i,{get:()=>t[i],enumerable:!(r=E(t,i))||r.enumerable});return e};var R=e=>$(g({},"__esModule",{value:!0}),e);var Ze={};u(Ze,{functionMapping:()=>U});typeof Deno>"u"&&(self.Deno={args:[],build:{arch:"x86_64"},env:{get(){}}});var h=new Map,y=0;function d(e){self.postMessage(e)}self.syscall=async(e,...t)=>await new Promise((o,r)=>{y++,h.set(y,{resolve:o,reject:r}),d({type:"sys",id:y,name:e,args:t})});function v(e,t){self.addEventListener("message",o=>{(async()=>{let r=o.data;switch(r.type){case"inv":{let i=e[r.name];if(!i)throw new Error(`Function not loaded: ${r.name}`);try{let a=await Promise.resolve(i(...r.args||[]));d({type:"invr",id:r.id,result:a})}catch(a){console.error("An exception was thrown as a result of invoking function",r.name,"error:",a),d({type:"invr",id:r.id,error:a.message})}}break;case"sysr":{let i=r.id,a=h.get(i);if(!a)throw Error("Invalid request id");h.delete(i),r.error?a.reject(new Error(r.error)):a.resolve(r.result)}break}})().catch(console.error)}),d({type:"manifest",manifest:t})}function O(e){let t=atob(e),o=t.length,r=new Uint8Array(o);for(let i=0;i<o;i++)r[i]=t.charCodeAt(i);return r}function A(e){typeof e=="string"&&(e=new TextEncoder().encode(e));let t="",o=e.byteLength;for(let r=0;r<o;r++)t+=String.fromCharCode(e[r]);return btoa(t)}async function q(e,t){if(typeof e!="string"){let o=new Uint8Array(await e.arrayBuffer()),r=o.length>0?A(o):void 0;t={method:e.method,headers:Object.fromEntries(e.headers.entries()),base64Body:r},e=e.url}return syscall("sandboxFetch.fetch",e,t)}function B(){globalThis.nativeFetch=globalThis.fetch,globalThis.fetch=async function(e,t){let o=t&&t.body?A(new Uint8Array(await new Response(t.body).arrayBuffer())):void 0,r=await q(e,t&&{method:t.method,headers:t.headers,base64Body:o});return new Response(r.base64Body?O(r.base64Body):null,{status:r.status,headers:r.headers})}}B();var s={};u(s,{confirm:()=>ue,dispatch:()=>ce,downloadFile:()=>X,filterBox:()=>te,flashNotification:()=>ee,fold:()=>pe,foldAll:()=>he,getCurrentPage:()=>L,getCursor:()=>W,getSelection:()=>j,getText:()=>Q,getUiOption:()=>me,hidePanel:()=>ne,insertAtCursor:()=>se,insertAtPos:()=>oe,moveCursor:()=>ae,navigate:()=>V,openUrl:()=>J,prompt:()=>le,reloadPage:()=>z,reloadUI:()=>H,replaceRange:()=>ie,save:()=>_,setPage:()=>Y,setSelection:()=>G,setUiOption:()=>de,showPanel:()=>re,toggleFold:()=>ye,unfold:()=>ge,unfoldAll:()=>xe,uploadFile:()=>Z,vimEx:()=>fe});typeof self>"u"&&(self={syscall:()=>{throw new Error("Not implemented here")}});var n=self.syscall;function L(){return n("editor.getCurrentPage")}function Y(e){return n("editor.setPage",e)}function Q(){return n("editor.getText")}function W(){return n("editor.getCursor")}function j(){return n("editor.getSelection")}function G(e,t){return n("editor.setSelection",e,t)}function _(){return n("editor.save")}function V(e,t,o=!1,r=!1){return n("editor.navigate",e,t,o,r)}function z(){return n("editor.reloadPage")}function H(){return n("editor.reloadUI")}function J(e,t=!1){return n("editor.openUrl",e,t)}function X(e,t){return n("editor.downloadFile",e,t)}function Z(e=null,t=null){return n("editor.uploadFile",e,t)}function ee(e,t="info"){return n("editor.flashNotification",e,t)}function te(e,t,o="",r=""){return n("editor.filterBox",e,t,o,r)}function re(e,t,o,r=""){return n("editor.showPanel",e,t,o,r)}function ne(e){return n("editor.hidePanel",e)}function oe(e,t){return n("editor.insertAtPos",e,t)}function ie(e,t,o){return n("editor.replaceRange",e,t,o)}function ae(e,t=!1){return n("editor.moveCursor",e,t)}function se(e){return n("editor.insertAtCursor",e)}function ce(e){return n("editor.dispatch",e)}function le(e,t=""){return n("editor.prompt",e,t)}function ue(e){return n("editor.confirm",e)}function me(e){return n("editor.getUiOption",e)}function de(e,t){return n("editor.setUiOption",e,t)}function fe(e){return n("editor.vimEx",e)}function pe(){return n("editor.fold")}function ge(){return n("editor.unfold")}function ye(){return n("editor.toggleFold")}function he(){return n("editor.foldAll")}function xe(){return n("editor.unfoldAll")}var f={};u(f,{parseMarkdown:()=>Pe});function Pe(e){return n("markdown.parseMarkdown",e)}var c={};u(c,{deleteAttachment:()=>De,deleteFile:()=>Ke,deletePage:()=>Ae,getAttachmentMeta:()=>Me,getFileMeta:()=>Ee,getPageMeta:()=>we,listAttachments:()=>Ce,listFiles:()=>ke,listPages:()=>Te,listPlugs:()=>Se,readAttachment:()=>Ie,readFile:()=>Ue,readPage:()=>be,writeAttachment:()=>Fe,writeFile:()=>Ne,writePage:()=>ve});function Te(e=!1){return n("space.listPages",e)}function we(e){return n("space.getPageMeta",e)}function be(e){return n("space.readPage",e)}function ve(e,t){return n("space.writePage",e,t)}function Ae(e){return n("space.deletePage",e)}function Se(){return n("space.listPlugs")}function Ce(){return n("space.listAttachments")}function Me(e){return n("space.getAttachmentMeta",e)}function Ie(e){return n("space.readAttachment",e)}function Fe(e,t){return n("space.writeAttachment",e,t)}function De(e){return n("space.deleteAttachment",e)}function ke(){return n("space.listFiles")}function Ue(e){return n("space.readFile",e)}function Ee(e){return n("space.getFileMeta",e)}function Ne(e,t){return n("space.writeFile",e,t)}function Ke(e){return n("space.deleteFile",e)}function x(e,t){if(t(e))return[e];let o=[];if(e.children)for(let r of e.children)o=[...o,...x(r,t)];return o}function P(e,t){return x(e,o=>o.type===t)[0]}function S(e,t){x(e,t)}var l=globalThis.syscall;var m={};u(m,{parse:()=>Ge,stringify:()=>_e});function Ge(e){return l("yaml.parse",e)}function _e(e){return l("yaml.stringify",e)}async function He(e,t){let o=await c.readPage(e),r=await f.parseMarkdown(o),i;return S(r,a=>{if(a.type!=="FencedCode")return!1;let w=P(a,"CodeInfo");if(t&&!w||t&&!t.includes(w.children[0].text))return!1;let b=P(a,"CodeText");return b?(i=b.children[0].text,!0):!1}),i}async function C(e,t=["yaml"]){let o=await He(e,t);if(o!==void 0)try{return m.parse(o)}catch(r){throw console.error("YAML Page parser error",r),new Error(`YAML Error: ${r.message}`)}}var Je="SETTINGS";async function p(e){try{let t=await C(Je,["yaml"])||{},o={};for(let[r,i]of Object.entries(e))r in t?o[r]=t[r]:o[r]=i;return o}catch(t){if(t.message==="Not found")return e;throw t}}function M(e){function t(o){let r=String(o);return r.length===1&&(r="0"+r),r}return e.getFullYear()+"-"+t(e.getMonth()+1)+"-"+t(e.getDate())}async function I(e=null,t=null){let{attachImagePrefix:o}=await p({attachImagePrefix:"images"});e??=o;let r=await s.uploadFile("image/*",t),i=await s.prompt("Name:",`${e}/${r.name}`);i&&(await c.writeAttachment(i,r.content),s.insertAtCursor(`![](${i})`))}async function T(){let{cameraImagePrefix:e}=await p({cameraImagePrefix:"images/camera"});I(e,"environment")}async function F(){let{dailyImagePrefix:e}=await p({dailyImagePrefix:"images/daily"}),t=await s.uploadFile("image/*"),o=t.name.split(".").pop(),r=await s.prompt("Daily image name:",`${e}/${M(new Date)}.${o}`);r&&(await c.writeAttachment(r,t.content),s.insertAtCursor(`![](${r})`))}async function D(e){I()}async function k(e){T()}var U={attachDailyImage:F,attachCameraImage:T,insertImage:D,insertCameraImage:k},Xe={name:"attach",functions:{attachDailyImage:{path:"attach.ts:attachDailyImage",command:{name:"Attach: Daily image"}},attachCameraImage:{path:"attach.ts:attachCameraImage",command:{name:"Attach: Camera Image"}},insertImage:{path:"attach.ts:insertImage",slashCommand:{name:"attach",description:"Attach an image"}},insertCameraImage:{path:"attach.ts:insertCameraImage",slashCommand:{name:"camera",description:"Attach an image from the device camera"}}},assets:{}};v(U,Xe);return R(Ze);})();
